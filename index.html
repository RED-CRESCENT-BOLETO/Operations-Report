<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>Ù†Ø¸Ø§Ù… EMS - Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</title>
Â  Â  <style>
Â  Â  Â  Â  :root { --red: #b32633; --blue: #0056b3; --gold: #ffd700; --bg: #0a0a0a; --purple: #6a1b9a; --white: #ffffff; }
Â  Â  Â  Â  body { font-family: 'Segoe UI', sans-serif; background: #111 url('https://i.top4top.io/p_3592jzcr01.jpg') no-repeat center center fixed; background-size: cover; color: white; margin: 0; padding: 10px; padding-bottom: 120px; }
Â  Â  Â  Â  .overlay-bg { background: rgba(0,0,0,0.88); min-height: 100vh; padding: 20px; border-radius: 15px; }
Â  Â  Â  Â  .mode-selection { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
Â  Â  Â  Â  .btn-mode { flex: 1; max-width: 400px; padding: 18px; font-size: 22px; font-weight: 900; border-radius: 12px; border: 3px solid #333; cursor: pointer; color: white; background: #222; transition: 0.3s; }
Â  Â  Â  Â  #lsTabBtn.active { background: var(--red); border-color: white; box-shadow: 0 0 15px var(--red); }
Â  Â  Â  Â  #sbTabBtn.active { background: var(--blue); border-color: white; box-shadow: 0 0 15px var(--blue); }
Â  Â  Â  Â  .system-container { display: none; }
Â  Â  Â  Â  .system-container.active { display: block; }
Â  Â  Â  Â  .info-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg); padding: 12px; border-bottom: 3px solid #444; border-radius: 10px; margin-bottom: 20px; }
Â  Â  Â  Â  .ls-border { border-bottom-color: var(--red) !important; }
Â  Â  Â  Â  .sb-border { border-bottom-color: var(--blue) !important; }
Â  Â  Â  Â  .main-controls { background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; border: 1px solid #555; margin: 0 auto 30px auto; width: 96%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
Â  Â  Â  Â  .letter-group { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; width: 100%; }
Â  Â  Â  Â  .let-btn { width: 65px; height: 65px; border: 2px solid #444; background: #222; color: white; border-radius: 12px; cursor: pointer; font-size: 26px; font-weight: bold; }
Â  Â  Â  Â  .let-btn.active-ls { background: var(--red); border-color: white; box-shadow: 0 0 10px var(--red); }
Â  Â  Â  Â  .let-btn.active-sb { background: var(--blue); border-color: white; box-shadow: 0 0 10px var(--blue); }
Â  Â  Â  Â  .main-input { font-size: 55px; width: 220px; text-align: center; background: #000; border: 2px solid #555; border-radius: 15px; padding: 10px; outline: none; }
Â  Â  Â  Â  .ls-input { color: var(--red); }
Â  Â  Â  Â  .sb-input { color: var(--blue); }
Â  Â  Â  Â  .btn-side { padding: 15px 25px; background: #333; color: white; border: 1px solid #555; border-radius: 10px; font-weight: bold; font-size: 20px; cursor: pointer; }
Â  Â  Â  Â  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 25px; }
Â  Â  Â  Â  .card { background: rgba(0,0,0,0.7); border: 1px solid #444; border-radius: 10px; min-height: 120px; }
Â  Â  Â  Â  .card-header { padding: 10px; text-align: center; font-weight: bold; border-radius: 10px 10px 0 0; }
Â  Â  Â  Â  .ls-header { background: var(--red); }
Â  Â  Â  Â  .sb-header { background: var(--blue); }
Â  Â  Â  Â  .card-purple .card-header { background: var(--purple) !important; }
Â  Â  Â  Â  .card-white .card-header { background: var(--white) !important; color: black; }
Â  Â  Â  Â  .card-body { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
Â  Â  Â  Â  .tag { background: #000; border: 1px solid #444; padding: 6px 14px; border-radius: 6px; font-weight: bold; position: relative; cursor: pointer; }
Â  Â  Â  Â  .ls-tag { border-color: var(--red); }
Â  Â  Â  Â  .sb-tag { border-color: var(--blue); }
Â  Â  Â  Â  .tag-menu { display: none; position: absolute; top: 100%; right: 0; background: #222; z-index: 100; border: 1px solid #555; width: 120px; }
Â  Â  Â  Â  .tag:hover .tag-menu { display: block; }
Â  Â  Â  Â  .tag-menu div { padding: 10px; cursor: pointer; border-bottom: 1px solid #333; }
Â  Â  Â  Â  .bottom-actions { position: fixed; bottom: 0; left: 0; right: 0; background: #050505; padding: 20px; display: flex; justify-content: center; border-top: 3px solid #444; }
Â  Â  </style>
</head>
<body>

<div class="overlay-bg">
Â  Â  <div class="mode-selection">
Â  Â  Â  Â  <button class="btn-mode active" id="lsTabBtn" onclick="switchSystem('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (LS)</button>
Â  Â  Â  Â  <button class="btn-mode" id="sbTabBtn" onclick="switchSystem('SB')">Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (SB)</button>
Â  Â  </div>

Â  Â  <div id="systemLS" class="system-container active">
Â  Â  Â  Â  <div class="info-bar ls-border">
Â  Â  Â  Â  Â  Â  <div>ØªÙ‚Ø±ÙŠØ± LS Ø±Ù‚Ù…: <button onclick="changeRepNum('LS')" id="repNumLS" style="background:none; color:var(--gold); border:1px solid #444; padding:5px 15px; cursor:pointer;">1</button></div>
Â  Â  Â  Â  Â  Â  <div class="clock" style="font-size:20px; color:var(--gold)">00:00:00</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="main-controls">
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="background:#27ae60; border:2px solid #fff;" onclick="randomizeExcluding('LS')">ğŸ”„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ù…ÙŠØ¯Ø§Ù†ÙŠ)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="background:#600" onclick="resetSys('LS')">âš ï¸ ØªØµÙÙŠØ± LS</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="lettersLS" class="letter-group"></div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="toggleDigits('LS')" id="digitBtnLS">3 Ø£Ø±Ù‚Ø§Ù…</button>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="inputLS" class="main-input ls-input" placeholder="000" maxlength="4" oninput="handleInput('LS', this)">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="color:var(--gold)" onclick="undo('LS')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">â• Ù‚ÙŠØ§Ø¯Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">â• Ø§Ø´Ø±Ø§Ù</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">â• Ù…Ø´Ø±Ù</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">â• Ø¨Ø­Ø«</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">â• Ù…ÙŠÙ†Ø§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('LS','Ø¯Ø¹Ù…')">â• Ø¯Ø¹Ù…</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="grid" id="gridFieldLS"></div>
Â  Â  Â  Â  <div class="grid" id="gridAdminLS"></div>
Â  Â  Â  Â  <div class="grid" id="gridExitLS"></div>
Â  Â  </div>

Â  Â  <div id="systemSB" class="system-container">
Â  Â  Â  Â  <div class="info-bar sb-border">
Â  Â  Â  Â  Â  Â  <div>ØªÙ‚Ø±ÙŠØ± SB Ø±Ù‚Ù…: <button onclick="changeRepNum('SB')" id="repNumSB" style="background:none; color:var(--gold); border:1px solid #444; padding:5px 15px; cursor:pointer;">1</button></div>
Â  Â  Â  Â  Â  Â  <div class="clock" style="font-size:20px; color:var(--gold)">00:00:00</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="main-controls">
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="background:#27ae60; border:2px solid #fff;" onclick="randomizeExcluding('SB')">ğŸ”„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ù…ÙŠØ¯Ø§Ù†ÙŠ)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="background:#600" onclick="resetSys('SB')">âš ï¸ ØªØµÙÙŠØ± SB</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="lettersSB" class="letter-group"></div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="toggleDigits('SB')" id="digitBtnSB">3 Ø£Ø±Ù‚Ø§Ù…</button>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="inputSB" class="main-input sb-input" placeholder="000" maxlength="4" oninput="handleInput('SB', this)">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" style="color:var(--gold)" onclick="undo('SB')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">â• Ù‚ÙŠØ§Ø¯Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">â• Ø§Ø´Ø±Ø§Ù</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">â• Ù…Ø´Ø±Ù</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">â• Ø¨Ø­Ø«</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">â• Ù…ÙŠÙ†Ø§Ø¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-side" onclick="manualAdd('SB','Ø¯Ø¹Ù…')">â• Ø¯Ø¹Ù…</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="grid" id="gridFieldSB"></div>
Â  Â  Â  Â  <div class="grid" id="gridAdminSB"></div>
Â  Â  Â  Â  <div class="grid" id="gridExitSB"></div>
Â  Â  </div>
</div>

<div class="bottom-actions">
Â  Â  <button id="copyBtn" onclick="copyAction()" style="padding: 15px 100px; background:#218838; color:white; border-radius:10px; font-weight:bold; font-size:22px; cursor:pointer;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<script>
Â  Â  let currentSystem = 'LS';
Â  Â  const config = {
Â  Â  Â  Â  LS: { activeLet: 'E', digits: 3, count: 0, history: [], storageKey: 'ems_final_v11_ls' },
Â  Â  Â  Â  SB: { activeLet: 'E', digits: 3, count: 0, history: [], storageKey: 'ems_final_v11_sb' }
Â  Â  };

Â  Â  const protectedKeys = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø¯Ø¹Ù…", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"];

Â  Â  let dataLS = { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù„Ø§Ù… 1":[], "Ù„Ø§Ù… 2":[], "Ù„Ø§Ù… 3":[], "Ù„Ø§Ù… 4":[], "Ù„Ø§Ù… 5":[], "ÙØ±Ø³Ø§Ù†":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] };
Â  Â  let dataSB = { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ø³ÙŠÙ† 1":[], "Ø³ÙŠÙ†":[], "Ø¨Ø§Ø¡ 1":[], "Ø¨Ø§Ø¡":[], "Ø¬ÙŠÙ… 1":[], "Ø¬ÙŠÙ… 2":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] };

Â  Â  function isDuplicateAllowed(sys, fullCode, targetKey) {
Â  Â  Â  Â  const manualKeys = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø¯Ø¹Ù…"];
Â  Â  Â  Â  if (manualKeys.includes(targetKey)) return false;
Â  Â  Â  Â  let d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  for (let key in d) { if (d[key].includes(fullCode)) return true; }
Â  Â  Â  Â  return false;
Â  Â  }

Â  Â  function handleInput(sys, el) {
Â  Â  Â  Â  el.value = el.value.replace(/[^0-9]/g, '');
Â  Â  Â  Â  let limit = (['M', 'F', 'A', 'S'].includes(config[sys].activeLet)) ? 2 : config[sys].digits;
Â  Â  Â  Â  if (el.value.length >= limit) {
Â  Â  Â  Â  Â  Â  let fullCode = config[sys].activeLet + "-" + el.value;
Â  Â  Â  Â  Â  Â  let target = getNextTarget(sys);
Â  Â  Â  Â  Â  Â  if (isDuplicateAllowed(sys, fullCode, target)) { alert("âš ï¸ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙƒØ±Ø±!"); el.value = ''; return; }
Â  Â  Â  Â  Â  Â  (sys === 'LS' ? dataLS : dataSB)[target].push(fullCode);
Â  Â  Â  Â  Â  Â  config[sys].history.push({target: target});
Â  Â  Â  Â  Â  Â  el.value = ''; renderSpecific(sys);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„ÙŠØ¹ÙŠØ¯ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙ‚Ø·
Â  Â  function randomizeExcluding(sys) {
Â  Â  Â  Â  let d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  let fieldKeys = (sys === 'LS') ? ["Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2"];
Â  Â  Â  Â Â 
Â  Â  Â  Â  let pool = [];
Â  Â  Â  Â  fieldKeys.forEach(k => {
Â  Â  Â  Â  Â  Â  pool.push(...d[k]);
Â  Â  Â  Â  Â  Â  d[k] = [];
Â  Â  Â  Â  });

Â  Â  Â  Â  // Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ© (Fisher-Yates shuffle)
Â  Â  Â  Â  for (let i = pool.length - 1; i > 0; i--) {
Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));
Â  Â  Â  Â  Â  Â  [pool[i], pool[j]] = [pool[j], pool[i]];
Â  Â  Â  Â  }

Â  Â  Â  Â  config[sys].count = 0;
Â  Â  Â  Â  pool.forEach(unit => {
Â  Â  Â  Â  Â  Â  let target = getNextTarget(sys, true);
Â  Â  Â  Â  Â  Â  d[target].push(unit);
Â  Â  Â  Â  });

Â  Â  Â  Â  renderSpecific(sys);
Â  Â  }

Â  Â  function getNextTarget(sys, skipOps = false) {
Â  Â  Â  Â  let d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  if (!skipOps) {
Â  Â  Â  Â  Â  Â  if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
Â  Â  Â  Â  Â  Â  if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
Â  Â  Â  Â  }
Â  Â  Â  Â  if (sys === 'LS') {
Â  Â  Â  Â  Â  Â  config.LS.count++;
Â  Â  Â  Â  Â  Â  const order = [null, "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5"];
Â  Â  Â  Â  Â  Â  return (config.LS.count <= 13) ? order[config.LS.count] : ["Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"][(config.LS.count-14)%6];
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  let fieldOnlyKeys = ["Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2"];
Â  Â  Â  Â  Â  Â  let total = fieldOnlyKeys.reduce((s, k) => s + d[k].length, 0);
Â  Â  Â  Â  Â  Â  return fieldOnlyKeys[total % 6];
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function autoRebalance(sys) {
Â  Â  Â  Â  let d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  let fieldOnlyKeys = (sys === 'LS') ? ["Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2"];
Â  Â  Â  Â  let pool = [];
Â  Â  Â  Â  fieldOnlyKeys.forEach(k => { pool.push(...d[k]); d[k] = []; });
Â  Â  Â  Â  config[sys].count = 0;
Â  Â  Â  Â  pool.forEach(unit => { d[getNextTarget(sys, true)].push(unit); });
Â  Â  Â  Â  renderSpecific(sys);
Â  Â  }

Â  Â  function move(sys, k, i) {Â 
Â  Â  Â  Â  (sys === 'LS' ? dataLS : dataSB)["ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"].push((sys === 'LS' ? dataLS : dataSB)[k].splice(i, 1)[0]);Â 
Â  Â  Â  Â  if (!protectedKeys.includes(k)) autoRebalance(sys); else renderSpecific(sys);
Â  Â  }
Â  Â Â 
Â  Â  function del(sys, k, i) {Â 
Â  Â  Â  Â  (sys === 'LS' ? dataLS : dataSB)[k].splice(i, 1);Â 
Â  Â  Â  Â  if (!protectedKeys.includes(k)) autoRebalance(sys); else renderSpecific(sys);
Â  Â  }

Â  Â  function undo(sys) {
Â  Â  Â  Â  if (config[sys].history.length > 0) {
Â  Â  Â  Â  Â  Â  let last = config[sys].history.pop();
Â  Â  Â  Â  Â  Â  (sys === 'LS' ? dataLS : dataSB)[last.target].pop();
Â  Â  Â  Â  Â  Â  if (!protectedKeys.includes(last.target) && config[sys].count > 0) config[sys].count--;
Â  Â  Â  Â  Â  Â  renderSpecific(sys);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderSpecific(sys) {
Â  Â  Â  Â  const d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  const field = (sys === 'LS') ? ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2"];
Â  Â  Â  Â  const admin = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø¯Ø¹Ù…"];
Â  Â  Â  Â  const draw = (k) => {
Â  Â  Â  Â  Â  Â  let cls = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©","Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…","Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"].includes(k) ? 'card-purple' : (["ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°","Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡","Ø¯Ø¹Ù…"].includes(k) ? 'card-white' : '');
Â  Â  Â  Â  Â  Â  let tags = d[k].map((u, i) => `<div class="tag ${(sys==='LS'?'ls-tag':'sb-tag')}">${u}<div class="tag-menu"><div onclick="move('${sys}','${k}',${i})">â¡ï¸ Ø®Ø±ÙˆØ¬</div><div onclick="del('${sys}','${k}',${i})">âŒ Ø­Ø°Ù</div></div></div>`).join('');
Â  Â  Â  Â  Â  Â  return `<div class="card ${cls}"><div class="card-header ${(sys==='LS'?'ls-header':'sb-header')}">${k}</div><div class="card-body">${tags}</div></div>`;
Â  Â  Â  Â  };
Â  Â  Â  Â  document.getElementById(`gridField${sys}`).innerHTML = field.map(draw).join('');
Â  Â  Â  Â  document.getElementById(`gridAdmin${sys}`).innerHTML = admin.map(draw).join('');
Â  Â  Â  Â  document.getElementById(`gridExit${sys}`).innerHTML = draw("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
Â  Â  Â  Â  localStorage.setItem(config[sys].storageKey, JSON.stringify({data: d, count: config[sys].count}));
Â  Â  }

Â  Â  function copyAction() {
Â  Â  Â  Â  const sys = currentSystem;
Â  Â  Â  Â  const d = (sys === 'LS' ? dataLS : dataSB);
Â  Â  Â  Â  const rNum = document.getElementById(`repNum${sys}`).innerText;
Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø£Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
Â  Â  Â  Â  const dayName = days[now.getDay()];
Â  Â  Â  Â  const dateStr = now.getFullYear() + "/" + String(now.getMonth() + 1).padStart(2, '0') + "/" + String(now.getDate()).padStart(2, '0');
Â  Â  Â  Â  const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }).replace('AM', 'Øµ').replace('PM', 'Ù…');
Â  Â  Â  Â  let regionName = (sys === 'LS' ? 'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³' : 'Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ');
Â  Â  Â  Â  let txt = `ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª ( ${regionName} ) Ø±Ù‚Ù… ( ${rNum} ) ÙÙŠ ØªÙ…Ø§Ù… Ø§Ù„Ø³Ø§Ø¹Ø© ( ${timeStr} ) ÙÙŠ ÙŠÙˆÙ… ( ${dayName} ) Ø§Ù„ØªØ§Ø±ÙŠØ® ${dateStr}\n\n`;
Â  Â  Â  Â  const keysOrder = (sys === 'LS')Â 
Â  Â  Â  Â  Â  Â  ? ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"]
Â  Â  Â  Â  Â  Â  : ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"];
Â  Â  Â  Â  keysOrder.forEach(k => {
Â  Â  Â  Â  Â  Â  let content = (d[k] && d[k].length > 0) ? ( (k === "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" || k === "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª") ? d[k].join(' | ') + " |" : d[k].join('\n') ) : "E-000";
Â  Â  Â  Â  Â  Â  txt += `${k} :\n${content}\n\n`;
Â  Â  Â  Â  });
Â  Â  Â  Â  navigator.clipboard.writeText(txt).then(() => alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®"));
Â  Â  }

Â  Â  function switchSystem(sys) {
Â  Â  Â  Â  currentSystem = sys;
Â  Â  Â  Â  document.querySelectorAll('.system-container').forEach(c => c.classList.remove('active'));
Â  Â  Â  Â  document.getElementById(`system${sys}`).classList.add('active');
Â  Â  Â  Â  document.getElementById('lsTabBtn').classList.toggle('active', sys === 'LS');
Â  Â  Â  Â  document.getElementById('sbTabBtn').classList.toggle('active', sys === 'SB');
Â  Â  }
Â  Â  function manualAdd(sys, k) {Â 
Â  Â  Â  Â  let n = prompt("Ø±Ù‚Ù… Ø§Ù„ÙƒÙˆØ¯:"); if(n) {Â 
Â  Â  Â  Â  Â  Â  let full = config[sys].activeLet + "-" + n.replace(/[^0-9]/g, '');
Â  Â  Â  Â  Â  Â  (sys === 'LS' ? dataLS : dataSB)[k].push(full); renderSpecific(sys);Â 
Â  Â  Â  Â  }Â 
Â  Â  }
Â  Â  function resetSys(sys) { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) { localStorage.removeItem(config[sys].storageKey); location.reload(); }}
Â  Â  function changeRepNum(sys) { let n = prompt("Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±:"); if(n) document.getElementById(`repNum${sys}`).innerText = n; }
Â  Â  function toggleDigits(sys) { config[sys].digits = (config[sys].digits===3?4:3); document.getElementById(`digitBtn${sys}`).innerText = config[sys].digits + " Ø£Ø±Ù‚Ø§Ù…"; }

Â  Â  ['LS', 'SB'].forEach(sys => {
Â  Â  Â  Â  const lets = ['E','A','F','M','S','C','G','P','H'];
Â  Â  Â  Â  lets.forEach(l => {
Â  Â  Â  Â  Â  Â  let b = document.createElement('button'); b.className = 'let-btn' + (l === config[sys].activeLet ? ` active-${sys.toLowerCase()}` : ''); b.innerText = l;
Â  Â  Â  Â  Â  Â  b.onclick = () => { config[sys].activeLet = l; document.querySelectorAll(`#letters${sys} .let-btn`).forEach(x => x.classList.remove(`active-${sys.toLowerCase()}`)); b.classList.add(`active-${sys.toLowerCase()}`); };
Â  Â  Â  Â  Â  Â  document.getElementById(`letters${sys}`).appendChild(b);
Â  Â  Â  Â  });
Â  Â  Â  Â  const saved = JSON.parse(localStorage.getItem(config[sys].storageKey));
Â  Â  Â  Â  if(saved) { if(sys==='LS') dataLS = saved.data; else dataSB = saved.data; config[sys].count = saved.count; }
Â  Â  });
Â  Â  setInterval(() => { document.querySelectorAll('.clock').forEach(c => c.innerText = new Date().toLocaleTimeString('en-US', {hour12: false})); }, 1000);
Â  Â  renderSpecific('LS'); renderSpecific('SB');
</script>
</body>
</html>
