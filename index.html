<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>EMS SYSTEM - PRECISION DISTRIBUTION V20</title>
    <style>
        :root { --red: #b32633; --blue: #0056b3; --gold: #ffd700; --bg: #0a0a0a; --purple: #6a1b9a; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: #111 url('https://i.top4top.io/p_3592jzcr01.jpg') no-repeat center center fixed; background-size: cover; color: white; margin: 0; padding: 10px; padding-bottom: 120px; }
        .overlay-bg { background: rgba(0,0,0,0.92); min-height: 100vh; padding: 20px; border-radius: 15px; }
        .mode-selection { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .btn-mode { flex: 1; max-width: 400px; padding: 18px; font-size: 22px; font-weight: 900; border-radius: 12px; border: 3px solid #333; cursor: pointer; color: white; background: #222; }
        #lsTabBtn.active { background: var(--red); border-color: white; box-shadow: 0 0 15px var(--red); }
        #sbTabBtn.active { background: var(--blue); border-color: white; box-shadow: 0 0 15px var(--blue); }
        .system-container { display: none; }
        .system-container.active { display: block; }
        .info-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg); padding: 12px; border-bottom: 3px solid #444; border-radius: 10px; margin-bottom: 20px; }
        .main-controls { background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; border: 1px solid #555; margin: 0 auto 30px auto; width: 96%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .let-btn { width: 65px; height: 65px; border: 2px solid #444; background: #222; color: white; border-radius: 12px; cursor: pointer; font-size: 26px; font-weight: bold; }
        .let-btn.active-ls { background: var(--red); border-color: white; }
        .let-btn.active-sb { background: var(--blue); border-color: white; }
        .main-input { font-size: 55px; width: 220px; text-align: center; background: #000; border: 2px solid #555; border-radius: 15px; padding: 10px; outline: none; }
        .btn-side { padding: 15px 25px; background: #333; color: white; border: 1px solid #555; border-radius: 10px; font-weight: bold; font-size: 20px; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .card { background: rgba(0,0,0,0.7); border: 1px solid #444; border-radius: 10px; min-height: 120px; }
        .card-header { padding: 10px; text-align: center; font-weight: bold; border-radius: 10px 10px 0 0; }
        .ls-header { background: var(--red); }
        .sb-header { background: var(--blue); }
        .card-purple .card-header { background: var(--purple) !important; }
        .card-white .card-header { background: var(--white) !important; color: black; }
        .card-body { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .tag { background: #000; border: 1px solid #444; padding: 6px 14px; border-radius: 6px; font-weight: bold; position: relative; cursor: pointer; }
        .tag-menu { display: none; position: absolute; top: 100%; right: 0; background: #222; z-index: 100; border: 1px solid #555; width: 120px; }
        .tag:hover .tag-menu { display: block; }
        .tag-menu div { padding: 10px; border-bottom: 1px solid #333; text-align: center; color: white; font-size: 14px; }
        .tag-menu div:hover { background: #444; }
        .bottom-actions { position: fixed; bottom: 0; left: 0; right: 0; background: #050505; padding: 20px; display: flex; justify-content: center; border-top: 3px solid #444; z-index: 1000; }
    </style>
</head>
<body>

<div class="overlay-bg">
    <div class="mode-selection">
        <button class="btn-mode active" id="lsTabBtn" onclick="switchSystem('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (LS)</button>
        <button class="btn-mode" id="sbTabBtn" onclick="switchSystem('SB')">Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (SB)</button>
    </div>

    <div id="systemLS" class="system-container active">
        <div class="info-bar" style="border-bottom-color: var(--red);">
            <div>ØªÙ‚Ø±ÙŠØ± LS Ø±Ù‚Ù…: <button onclick="changeRepNum('LS')" id="repNumLS" style="background:none; color:var(--gold); border:1px solid #444; cursor:pointer; padding:5px 15px;">1</button></div>
            <div class="clock" style="font-size:20px; color:var(--gold)">00:00:00</div>
        </div>
        <div class="main-controls">
            <div style="display:flex; gap:10px;"><button class="btn-side" style="background:#600" onclick="resetSys('LS')">âš ï¸ ØªØµÙÙŠØ± LS</button></div>
            <div id="lettersLS" class="letter-group"></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-side" onclick="toggleDigits('LS')" id="digitBtnLS">3 Ø£Ø±Ù‚Ø§Ù…</button>
                <input type="text" id="inputLS" class="main-input" style="color:var(--red)" placeholder="000" maxlength="4" oninput="handleInput('LS', this)">
                <button class="btn-side" onclick="undo('LS')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-side" onclick="manualAdd('LS','Ù‚ÙŠØ§Ø¯Ø©')">+ Ù‚ÙŠØ§Ø¯Ø©</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">+ Ø§Ø´Ø±Ø§Ù</button>
                <button class="btn-side" onclick="manualAdd('LS','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">+ Ù…Ø´Ø±Ù</button>
                <button class="btn-side" onclick="manualAdd('LS','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">+ Ø¨Ø­Ø«</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">+ Ù…ÙŠÙ†Ø§Ø¡</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø¯Ø¹Ù…')">+ Ø¯Ø¹Ù…</button>
            </div>
        </div>
        <div class="grid" id="gridAdminLS"></div>
        <div class="grid" id="gridFieldLS"></div>
        <div class="grid" id="gridExitLS"></div>
    </div>

    <div id="systemSB" class="system-container">
        <div class="info-bar" style="border-bottom-color: var(--blue);">
            <div>ØªÙ‚Ø±ÙŠØ± SB Ø±Ù‚Ù…: <button onclick="changeRepNum('SB')" id="repNumSB" style="background:none; color:var(--gold); border:1px solid #444; cursor:pointer; padding:5px 15px;">1</button></div>
            <div class="clock" style="font-size:20px; color:var(--gold)">00:00:00</div>
        </div>
        <div class="main-controls">
            <div style="display:flex; gap:10px;"><button class="btn-side" style="background:#600" onclick="resetSys('SB')">âš ï¸ ØªØµÙÙŠØ± SB</button></div>
            <div id="lettersSB" class="letter-group"></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-side" onclick="toggleDigits('SB')" id="digitBtnSB">3 Ø£Ø±Ù‚Ø§Ù…</button>
                <input type="text" id="inputSB" class="main-input" style="color:var(--blue)" placeholder="000" maxlength="4" oninput="handleInput('SB', this)">
                <button class="btn-side" onclick="undo('SB')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-side" onclick="manualAdd('SB','Ù‚ÙŠØ§Ø¯Ø©')">+ Ù‚ÙŠØ§Ø¯Ø©</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">+ Ø§Ø´Ø±Ø§Ù</button>
                <button class="btn-side" onclick="manualAdd('SB','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">+ Ù…Ø´Ø±Ù</button>
                <button class="btn-side" onclick="manualAdd('SB','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">+ Ø¨Ø­Ø«</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">+ Ù…ÙŠÙ†Ø§Ø¡</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø¯Ø¹Ù…')">+ Ø¯Ø¹Ù…</button>
            </div>
        </div>
        <div class="grid" id="gridAdminSB"></div>
        <div class="grid" id="gridFieldSB"></div>
        <div class="grid" id="gridExitSB"></div>
    </div>
</div>

<div class="bottom-actions">
    <button onclick="copyCurrentReport()" style="padding: 15px 100px; background:#218838; color:white; border-radius:10px; font-weight:bold; font-size:22px; cursor:pointer; border:none;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<script>
    let currentSystem = 'LS';
    const config = {
        LS: { activeLet: 'E', digits: 3, history: [], rep: 1 },
        SB: { activeLet: 'E', digits: 3, history: [], rep: 1 }
    };

    const keysLS = ["Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];
    const keysSB = ["Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];

    let dataLS = {}; keysLS.forEach(k => dataLS[k] = []);
    let dataSB = {}; keysSB.forEach(k => dataSB[k] = []);

    function handleInput(sys, el) {
        el.value = el.value.replace(/\D/g, '');
        let targetDigits = (['M', 'F', 'A', 'S'].includes(config[sys].activeLet)) ? 2 : config[sys].digits;
        
        if (el.value.length >= targetDigits) {
            let fullCode = config[sys].activeLet + "-" + el.value;
            let target = (sys === 'LS') ? getTargetLS() : getTargetSB();

            // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ø¹ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
            const d = (sys === 'LS' ? dataLS : dataSB);
            const exceptions = ["Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"];
            let exists = false;
            for(let key in d) if(d[key].includes(fullCode)) exists = true;

            if (exists && !exceptions.includes(target)) {
                alert("Ø§Ù„ÙƒÙˆØ¯ Ù…ÙƒØ±Ø±!");
            } else {
                d[target].push(fullCode);
                config[sys].history.push({target: target, code: fullCode});
            }
            el.value = ''; render(sys);
        }
    }

    // --- Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (Ø§Ù„Ø­Ø±ÙÙŠ) ---
    function getTargetLS() {
        let d = dataLS;
        if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        // Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø© Ø­Ø³Ø¨ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡
        let l1 = d["Ù„Ø§Ù… 1"].length, l2 = d["Ù„Ø§Ù… 2"].length, l3 = d["Ù„Ø§Ù… 3"].length, l4 = d["Ù„Ø§Ù… 4"].length, l5 = d["Ù„Ø§Ù… 5"].length, f = d["ÙØ±Ø³Ø§Ù†"].length;

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ÙˆØ­Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù„Ø§Ù… 5)
        if (l2 < 1) return "Ù„Ø§Ù… 2";
        if (l4 < 1) return "Ù„Ø§Ù… 4";
        if (l3 < 1) return "Ù„Ø§Ù… 3";
        if (l1 < 1) return "Ù„Ø§Ù… 1";
        if (f < 1) return "ÙØ±Ø³Ø§Ù†";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ÙˆØ­Ø¯ØªÙŠÙ†
        if (l2 < 2) return "Ù„Ø§Ù… 2";
        if (l4 < 2) return "Ù„Ø§Ù… 4";
        if (l3 < 2) return "Ù„Ø§Ù… 3";
        if (l1 < 2) return "Ù„Ø§Ù… 1";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø«Ù„Ø§Ø« ÙˆØ­Ø¯Ø§Øª (Ø­Ø³Ø¨ Ø§Ù„Ù†Øµ)
        if (l2 < 3) return "Ù„Ø§Ù… 2";
        if (l4 < 3) return "Ù„Ø§Ù… 4";
        if (l1 < 3) return "Ù„Ø§Ù… 1";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø¯Ø®ÙˆÙ„ Ù„Ø§Ù… 5
        if (l5 < 1) return "Ù„Ø§Ù… 5";

        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø§ØµÙ„ÙŠØ©
        return "Ù„Ø§Ù… 2";
    }

    // --- Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (Ø§Ù„Ø­Ø±ÙÙŠ) ---
    function getTargetSB() {
        let d = dataSB;
        if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        let s1 = d["Ø³ÙŠÙ† 1"].length, b1 = d["Ø¨Ø§Ø¡ 1"].length, s = d["Ø³ÙŠÙ†"].length, g1 = d["Ø¬ÙŠÙ… 1"].length, b = d["Ø¨Ø§Ø¡"].length, g2 = d["Ø¬ÙŠÙ… 2"].length;

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ÙˆØ­Ø¯Ø© ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†
        if (s1 < 1) return "Ø³ÙŠÙ† 1";
        if (b1 < 1) return "Ø¨Ø§Ø¡ 1";
        if (s < 1) return "Ø³ÙŠÙ†";
        if (g1 < 1) return "Ø¬ÙŠÙ… 1";
        if (b < 1) return "Ø¨Ø§Ø¡";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ÙˆØ­Ø¯ØªÙŠÙ†
        if (s1 < 2) return "Ø³ÙŠÙ† 1";
        if (b1 < 2) return "Ø¨Ø§Ø¡ 1";
        if (s < 2) return "Ø³ÙŠÙ†";
        if (g1 < 2) return "Ø¬ÙŠÙ… 1";
        if (b < 2) return "Ø¨Ø§Ø¡";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø«Ù„Ø§Ø« ÙˆØ­Ø¯Ø§Øª
        if (s1 < 3) return "Ø³ÙŠÙ† 1";
        if (b1 < 3) return "Ø¨Ø§Ø¡ 1";
        if (s < 3) return "Ø³ÙŠÙ†";
        if (g1 < 3) return "Ø¬ÙŠÙ… 1";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø£Ø±Ø¨Ø¹ ÙˆØ­Ø¯Ø§Øª
        if (s1 < 4) return "Ø³ÙŠÙ† 1";
        if (s < 4) return "Ø³ÙŠÙ†";
        if (b < 3) return "Ø¨Ø§Ø¡";
        if (b < 4) return "Ø¨Ø§Ø¡";

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø¯Ø®ÙˆÙ„ Ø¬ÙŠÙ… 2 (ÙˆØ­Ø¯Ø©ØŒ Ø«Ù†ØªÙŠÙ†ØŒ Ø«Ù„Ø§Ø«)
        if (g2 < 3) return "Ø¬ÙŠÙ… 2";

        return "Ø³ÙŠÙ† 1";
    }

    function render(sys) {
        const d = (sys === 'LS' ? dataLS : dataSB);
        const structure = (sys === 'LS') ? 
            { admin: ["Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"], field: ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 5"], extra: ["Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°"] } :
            { admin: ["Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"], field: ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"], extra: ["Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°"] };

        const drawCard = (k) => {
            let cls = structure.admin.includes(k) ? 'card-purple' : (structure.extra.includes(k) ? 'card-white' : '');
            let tags = d[k].map((u, i) => `
                <div class="tag">${u}
                    <div class="tag-menu">
                        <div onclick="moveToExit('${sys}','${k}',${i})">â¡ï¸ Ø®Ø±ÙˆØ¬</div>
                        <div onclick="deleteUnit('${sys}','${k}',${i})">âŒ Ø­Ø°Ù</div>
                    </div>
                </div>`).join('');
            return `<div class="card ${cls}"><div class="card-header ${(sys==='LS'?'ls-header':'sb-header')}">${k}</div><div class="card-body">${tags}</div></div>`;
        };

        document.getElementById(`gridAdmin${sys}`).innerHTML = structure.admin.concat(structure.extra).map(drawCard).join('');
        document.getElementById(`gridField${sys}`).innerHTML = structure.field.map(drawCard).join('');
        document.getElementById(`gridExit${sys}`).innerHTML = drawCard("ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬");
        document.getElementById(`repNum${sys}`).innerText = config[sys].rep;
    }

    function toggleDigits(sys) {
        config[sys].digits = (config[sys].digits === 3 ? 4 : 3);
        document.getElementById(`digitBtn${sys}`).innerText = config[sys].digits + " Ø£Ø±Ù‚Ø§Ù…";
    }

    function moveToExit(sys, k, i) {
        let d = (sys === 'LS' ? dataLS : dataSB);
        d["ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"].push(d[k].splice(i, 1)[0]);
        render(sys);
    }

    function deleteUnit(sys, k, i) { (sys === 'LS' ? dataLS : dataSB)[k].splice(i, 1); render(sys); }
    function manualAdd(sys, k) { let n = prompt("Ø§Ù„ÙƒÙˆØ¯:"); if(n) { (sys === 'LS' ? dataLS : dataSB)[k].push(config[sys].activeLet + "-" + n); render(sys); } }
    function changeRepNum(sys) { let n = prompt("Ø±Ù‚Ù…:"); if(n) { config[sys].rep = n; render(sys); } }
    function resetSys(sys) { if(confirm("ØªØµÙÙŠØ±ØŸ")) location.reload(); }
    function undo(sys) { if(config[sys].history.length) { let last = config[sys].history.pop(); (sys==='LS'?dataLS:dataSB)[last.target].pop(); render(sys); } }

    function switchSystem(sys) {
        currentSystem = sys;
        document.querySelectorAll('.system-container').forEach(c => c.classList.remove('active'));
        document.getElementById(`system${sys}`).classList.add('active');
        document.getElementById('lsTabBtn').classList.toggle('active', sys === 'LS');
        document.getElementById('sbTabBtn').classList.toggle('active', sys === 'SB');
    }

    function copyCurrentReport() {
        const sys = currentSystem; const d = (sys === 'LS' ? dataLS : dataSB);
        const keys = (sys === 'LS' ? keysLS : keysSB);
        const cityName = (sys === 'LS' ? 'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³' : 'Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ');
        const now = new Date();
        const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø£Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
        const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }).replace('AM', 'Øµ').replace('PM', 'Ù…');
        let txt = `ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª  ( ${cityName} ) Ø±Ù‚Ù… ( ${config[sys].rep} )  ÙÙŠ ØªÙ…Ø§Ù… Ø§Ù„Ø³Ø§Ø¹Ù‡  (${timeStr} )  ÙÙŠ ÙŠÙˆÙ… ( ${days[now.getDay()]} ) Ø§Ù„ØªØ§Ø±ÙŠØ® ${now.toLocaleDateString('en-CA').replace(/-/g,'/')}\n\n`;
        keys.forEach(k => {
            let units = (d[k].length > 0) ? ( (k === "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" || k === "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª") ? d[k].join(' | ') + " |" : d[k].join('\n') ) : "E-000";
            txt += `${k} :\n${units}\n\n`;
        });
        navigator.clipboard.writeText(txt).then(() => alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®"));
    }

    ['LS', 'SB'].forEach(sys => {
        const letters = ['E','A','F','M','S','C','G','P','H'];
        letters.forEach(l => {
            let b = document.createElement('button'); b.className = 'let-btn' + (l === 'E' ? ` active-${sys.toLowerCase()}` : ''); b.innerText = l;
            b.onclick = () => { config[sys].activeLet = l; document.querySelectorAll(`#letters${sys} .let-btn`).forEach(x => x.classList.remove(`active-ls`,`active-sb`)); b.classList.add(`active-${sys.toLowerCase()}`); };
            document.getElementById(`letters${sys}`).appendChild(b);
        });
    });

    setInterval(() => { document.querySelectorAll('.clock').forEach(c => c.innerText = new Date().toLocaleTimeString('en-GB')); }, 1000);
    render('LS'); render('SB');
</script>
</body>
</html>
