<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>EMS System - Professional Filtering</title>
    <style>
        :root { --red: #b32633; --blue: #0056b3; --gold: #ffd700; --bg: #0a0a0a; --purple: #6a1b9a; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: #111 url('https://i.top4top.io/p_3592jzcr01.jpg') no-repeat center center fixed; background-size: cover; color: white; margin: 0; padding: 10px; padding-bottom: 120px; }
        .overlay-bg { background: rgba(0,0,0,0.95); min-height: 100vh; padding: 20px; border-radius: 15px; }
        .mode-selection { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .btn-mode { flex: 1; max-width: 400px; padding: 18px; font-size: 22px; font-weight: 900; border-radius: 12px; border: 3px solid #333; cursor: pointer; color: white; background: #222; }
        #lsTabBtn.active { background: var(--red); border-color: white; box-shadow: 0 0 15px var(--red); }
        #sbTabBtn.active { background: var(--blue); border-color: white; box-shadow: 0 0 15px var(--blue); }
        .system-container { display: none; }
        .system-container.active { display: block; }
        .info-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg); padding: 12px; border-radius: 10px; margin-bottom: 20px; border-bottom: 4px solid #444; }
        .main-controls { background: rgba(0,0,0,0.85); padding: 25px; border-radius: 20px; border: 1px solid #555; margin-bottom: 30px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .let-btn { width: 42px; height: 50px; border: 2px solid #444; background: #222; color: white; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .active-ls { background: var(--red) !important; border-color: white !important; }
        .active-sb { background: var(--blue) !important; border-color: white !important; }
        .main-input { font-size: 50px; width: 180px; text-align: center; background: #000; border: 2px solid #555; border-radius: 15px; padding: 10px; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .card { background: rgba(0,0,0,0.8); border: 1px solid #444; border-radius: 12px; min-height: 140px; position: relative; } 
        .card-header { padding: 12px; text-align: center; font-weight: bold; font-size: 18px; border-radius: 12px 12px 0 0; } 
        .ls-header { background: var(--red); }
        .sb-header { background: var(--blue); }
        .card-purple .card-header { background: var(--purple) !important; }
        .card-white .card-header { background: var(--white) !important; color: black; }
        .card-body { padding: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; min-height: 60px; }
        .tag { background: #000; border: 1px solid #444; padding: 8px 12px; border-radius: 6px; font-weight: bold; position: relative; cursor: pointer; font-size: 14px; }
        .tag-menu { display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: #1a1a1a; z-index: 9999; border: 1px solid #555; width: 120px; border-radius: 5px; }
        .tag:hover .tag-menu { display: block; }
        .tag-menu div { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; text-align: center; color: white; }
        .tag-menu div:last-child { color: #ff4444; }
        .bottom-actions { position: fixed; bottom: 0; left: 0; right: 0; background: #050505; padding: 20px; display: flex; justify-content: center; border-top: 3px solid #444; gap: 20px; z-index: 1000; }
        .btn-side { padding: 10px 15px; background: #333; color: white; border-radius: 8px; cursor: pointer; border: 1px solid #555; font-weight: bold; }
        .import-box { width: 100%; max-width: 600px; background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; border: 1px solid #444; margin-bottom: 10px; }
        .import-area { width: 100%; height: 80px; background: #000; color: #2ecc71; border: 1px solid #555; border-radius: 8px; padding: 10px; font-size: 12px; resize: none; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="overlay-bg">
    <div class="mode-selection">
        <button class="btn-mode active" id="lsTabBtn" onclick="switchSystem('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (LS)</button>
        <button class="btn-mode" id="sbTabBtn" onclick="switchSystem('SB')">Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (SB)</button>
    </div>

    <div id="systemLS" class="system-container active">
        <div class="info-bar" style="border-color: var(--red);">
            <div>ØªÙ‚Ø±ÙŠØ± LS Ø±Ù‚Ù…: <span id="repNumLS" onclick="changeRepNum('LS')" style="color:var(--gold); cursor:pointer;">1</span></div>
            <div id="clockLS" style="color:var(--gold); font-weight:bold;">00:00</div>
        </div>
        <div class="main-controls">
            <div class="import-box">
                <textarea id="importAreaLS" class="import-area" placeholder="Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± LS Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯..."></textarea>
                <button class="btn-side" style="width:100%; background:#2980b9;" onclick="importReport('LS')">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ù„Ù‰ LS</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-side" style="background:#27ae60;" onclick="randomize('LS')">ğŸ”„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</button>
                <button class="btn-side" style="background:#600;" onclick="resetSys('LS')">âš ï¸ ØªØµÙÙŠØ± LS</button>
            </div>
            <div id="lettersLS" class="letter-group" style="display:flex; gap:5px;"></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-side" onclick="toggleDigits('LS')" id="digitBtnLS">3 Ø£Ø±Ù‚Ø§Ù…</button>
                <input type="text" id="inputLS" class="main-input" style="border-color:var(--red);" placeholder="000" maxlength="4" oninput="handleInput('LS', this)">
                <button class="btn-side" onclick="undo('LS')">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-side" onclick="manualAdd('LS','Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">â• Ù‚ÙŠØ§Ø¯Ø©</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">â• Ø§Ø´Ø±Ø§Ù</button>
                <button class="btn-side" onclick="manualAdd('LS','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">â• Ù…Ø´Ø±Ù</button>
                <button class="btn-side" onclick="manualAdd('LS','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">â• Ø¨Ø­Ø«</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">â• Ù…ÙŠÙ†Ø§Ø¡</button>
                <button class="btn-side" onclick="manualAdd('LS','Ø¯Ø¹Ù…')">â• Ø¯Ø¹Ù…</button>
            </div>
        </div>
        <div class="grid" id="gridFieldLS"></div>
        <div class="grid" id="gridAdminLS"></div>
        <div class="grid" id="gridExitLS"></div>
    </div>

    <div id="systemSB" class="system-container">
        <div class="info-bar" style="border-color: var(--blue);">
            <div>ØªÙ‚Ø±ÙŠØ± SB Ø±Ù‚Ù…: <span id="repNumSB" onclick="changeRepNum('SB')" style="color:var(--gold); cursor:pointer;">1</span></div>
            <div id="clockSB" style="color:var(--gold); font-weight:bold;">00:00</div>
        </div>
        <div class="main-controls">
            <div class="import-box">
                <textarea id="importAreaSB" class="import-area" placeholder="Ù„ØµÙ‚ ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ù†Ø¯ÙŠ Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯..."></textarea>
                <button class="btn-side" style="width:100%; background:#2980b9;" onclick="importReport('SB')">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ù„Ù‰ SB</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-side" style="background:#27ae60;" onclick="randomize('SB')">ğŸ”„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</button>
                <button class="btn-side" style="background:#600;" onclick="resetSys('SB')">âš ï¸ ØªØµÙÙŠØ± SB</button>
            </div>
            <div id="lettersSB" class="letter-group" style="display:flex; gap:5px;"></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-side" onclick="toggleDigits('SB')" id="digitBtnSB">3 Ø£Ø±Ù‚Ø§Ù…</button>
                <input type="text" id="inputSB" class="main-input" style="border-color:var(--blue);" placeholder="000" maxlength="4" oninput="handleInput('SB', this)">
                <button class="btn-side" onclick="undo('SB')">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-side" onclick="manualAdd('SB','Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">â• Ù‚ÙŠØ§Ø¯Ø©</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">â• Ø§Ø´Ø±Ø§Ù</button>
                <button class="btn-side" onclick="manualAdd('SB','Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">â• Ù…Ø´Ø±Ù</button>
                <button class="btn-side" onclick="manualAdd('SB','ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">â• Ø¨Ø­Ø«</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">â• Ù…ÙŠÙ†Ø§Ø¡</button>
                <button class="btn-side" onclick="manualAdd('SB','Ø¯Ø¹Ù…')">â• Ø¯Ø¹Ù…</button>
            </div>
        </div>
        <div class="grid" id="gridFieldSB"></div>
        <div class="grid" id="gridAdminSB"></div>
        <div class="grid" id="gridExitSB"></div>
    </div>
</div>

<div class="bottom-actions">
    <button onclick="copyAction()" style="padding:15px 120px; background:#218838; color:white; border-radius:10px; font-weight:bold; font-size:22px; cursor:pointer; border:none;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<script>
    let currentSystem = 'LS';
    const config = { 
        LS: { let: 'E', dig: 3, hist: [], storage: 'DATA_LS_FINAL_V9' }, 
        SB: { let: 'E', dig: 3, hist: [], storage: 'DATA_SB_FINAL_V9' } 
    };

    let dataLS = { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù„Ø§Ù… 1":[], "Ù„Ø§Ù… 2":[], "Ù„Ø§Ù… 3":[], "Ù„Ø§Ù… 4":[], "Ù„Ø§Ù… 5":[], "ÙØ±Ø³Ø§Ù†":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] };
    let dataSB = { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ø³ÙŠÙ† 1":[], "Ø³ÙŠÙ†":[], "Ø¨Ø§Ø¡ 1":[], "Ø¨Ø§Ø¡":[], "Ø¬ÙŠÙ… 1":[], "Ø¬ÙŠÙ… 2":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] };

    function handleInput(sys, el) {
        el.value = el.value.replace(/[^0-9]/g, '');
        let limit = (['M', 'F', 'A', 'S'].includes(config[sys].let)) ? 2 : config[sys].dig;
        if (el.value.length >= limit) {
            let code = config[sys].let + "-" + el.value;
            let d = (sys === 'LS' ? dataLS : dataSB);
            for(let k in d) if(d[k].includes(code)) { alert("âš ï¸ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙƒØ±Ø±!"); el.value = ''; return; }
            
            let target = (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) ? "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" : (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0 ? "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" : (sys === 'LS' ? logicLS(d) : logicSB(d)));
            
            d[target].push(code);
            config[sys].hist.push({sys: sys, t: target, c: code});
            el.value = ''; render(sys);
        }
    }

    function logicLS(d) {
        let n = d["Ù„Ø§Ù… 2"].length + d["Ù„Ø§Ù… 4"].length + d["Ù„Ø§Ù… 3"].length + d["Ù„Ø§Ù… 1"].length + d["ÙØ±Ø³Ø§Ù†"].length + d["Ù„Ø§Ù… 5"].length;
        if (n === 0) return "Ù„Ø§Ù… 2"; if (n === 1) return "Ù„Ø§Ù… 4"; if (n === 2) return "Ù„Ø§Ù… 3"; if (n === 3) return "Ù„Ø§Ù… 1"; if (n === 4) return "ÙØ±Ø³Ø§Ù†";
        if (n === 5) return "Ù„Ø§Ù… 2"; if (n === 6) return "Ù„Ø§Ù… 4"; if (n === 7) return "Ù„Ø§Ù… 3"; if (n === 8) return "Ù„Ø§Ù… 1";
        if (n === 9) return "Ù„Ø§Ù… 2"; if (n === 10) return "Ù„Ø§Ù… 4"; if (n === 11) return "Ù„Ø§Ù… 1"; if (n === 12) return "Ù„Ø§Ù… 5";
        return ["Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"][(n - 13) % 6] || "Ù„Ø§Ù… 2";
    }

    function logicSB(d) {
        let n = d["Ø³ÙŠÙ† 1"].length + d["Ø¨Ø§Ø¡ 1"].length + d["Ø³ÙŠÙ†"].length + d["Ø¬ÙŠÙ… 1"].length + d["Ø¨Ø§Ø¡"].length + d["Ø¬ÙŠÙ… 2"].length;
        if (n === 0) return "Ø³ÙŠÙ† 1"; if (n === 1) return "Ø¨Ø§Ø¡ 1"; if (n === 2) return "Ø³ÙŠÙ†"; if (n === 3) return "Ø¬ÙŠÙ… 1"; if (n === 4) return "Ø¨Ø§Ø¡";
        if (n === 5) return "Ø³ÙŠÙ† 1"; if (n === 6) return "Ø¨Ø§Ø¡ 1"; if (n === 7) return "Ø³ÙŠÙ†"; if (n === 8) return "Ø¬ÙŠÙ… 1"; if (n === 9) return "Ø¨Ø§Ø¡";
        if (n === 10) return "Ø³ÙŠÙ† 1"; if (n === 11) return "Ø¨Ø§Ø¡ 1"; if (n === 12) return "Ø³ÙŠÙ†"; if (n === 13) return "Ø¬ÙŠÙ… 1";
        if (n === 14) return "Ø³ÙŠÙ† 1"; if (n === 15) return "Ø³ÙŠÙ†"; if (n === 16) return "Ø¨Ø§Ø¡"; if (n === 17) return "Ø¨Ø§Ø¡";
        if (n === 18) return "Ø¬ÙŠÙ… 2"; if (n === 19) return "Ø¬ÙŠÙ… 2"; if (n === 20) return "Ø¬ÙŠÙ… 2";
        return ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"][(n - 21) % 6] || "Ø³ÙŠÙ† 1";
    }

    function render(sys) {
        const d = (sys === 'LS' ? dataLS : dataSB);
        const fKeys = (sys === 'LS') ? ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"];
        const aKeys = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø¯Ø¹Ù…"];
        const draw = (k) => {
            let cl = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©","Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…","Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"].includes(k) ? 'card-purple' : (["ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°","Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡","Ø¯Ø¹Ù…"].includes(k) ? 'card-white' : '');
            let tags = d[k].map((u, i) => `<div class="tag">${u}<div class="tag-menu"><div onclick="moveOut('${sys}','${k}',${i})">â¡ï¸ Ø®Ø±ÙˆØ¬</div><div onclick="delUnit('${sys}','${k}',${i})">âŒ Ø­Ø°Ù</div></div></div>`).join('');
            return `<div class="card ${cl}"><div class="card-header ${(sys==='LS'?'ls-header':'sb-header')}">${k}</div><div class="card-body">${tags}</div></div>`;
        };
        document.getElementById(`gridField${sys}`).innerHTML = fKeys.map(draw).join('');
        document.getElementById(`gridAdmin${sys}`).innerHTML = aKeys.map(draw).join('');
        document.getElementById(`gridExit${sys}`).innerHTML = draw("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
        localStorage.setItem(config[sys].storage, JSON.stringify(d));
    }

    function rebalanceFieldOnly(sys, keyDeleted) {
        let d = (sys==='LS'?dataLS:dataSB); 
        let fieldKeys = (sys==='LS') ? ["Ù„Ø§Ù… 1","Ù„Ø§Ù… 2","Ù„Ø§Ù… 3","Ù„Ø§Ù… 4","Ù„Ø§Ù… 5","ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1","Ø¨Ø§Ø¡ 1","Ø³ÙŠÙ†","Ø¬ÙŠÙ… 1","Ø¨Ø§Ø¡","Ø¬ÙŠÙ… 2"];
        if(fieldKeys.includes(keyDeleted)) {
            let pool = []; 
            fieldKeys.forEach(k => { pool.push(...d[k]); d[k]=[]; });
            pool.forEach(c => { d[(sys==='LS'?logicLS(d):logicSB(d))].push(c); });
        }
        render(sys);
    }

    function moveOut(sys, k, i) { let d = (sys==='LS'?dataLS:dataSB); d["ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"].push(d[k].splice(i, 1)[0]); rebalanceFieldOnly(sys, k); }
    function delUnit(sys, k, i) { let d = (sys==='LS'?dataLS:dataSB); d[k].splice(i, 1); rebalanceFieldOnly(sys, k); }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ«: ÙÙ„ØªØ±Ø© E-000 Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
    function importReport(sys) {
        let text = document.getElementById(`importArea${sys}`).value;
        if(!text.trim()) return;
        let d = (sys === 'LS' ? dataLS : dataSB);
        for(let key in d) d[key] = [];
        let sections = text.split(/\n(?=[Ø£-ÙŠ])/); 
        sections.forEach(section => {
            let header = section.split('\n')[0].split(':')[0].trim();
            if(header === "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬") header = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬";
            if(d[header]) {
                let matches = section.match(/[A-Z]-\d{2,4}/g);
                if(matches) {
                    matches.forEach(code => { 
                        // Ø´Ø±Ø· Ø§Ù„ÙÙ„ØªØ±Ø©: ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 000
                        if(!code.includes("000") && !d[header].includes(code)) {
                            d[header].push(code); 
                        }
                    });
                }
            }
        });
        document.getElementById(`importArea${sys}`).value = "";
        render(sys);
    }

    function randomize(sys) {
        let d = (sys==='LS'?dataLS:dataSB);
        let ks = (sys==='LS') ? ["Ù„Ø§Ù… 1","Ù„Ø§Ù… 2","Ù„Ø§Ù… 3","Ù„Ø§Ù… 4","Ù„Ø§Ù… 5","ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1","Ø¨Ø§Ø¡ 1","Ø³ÙŠÙ†","Ø¬ÙŠÙ… 1","Ø¨Ø§Ø¡","Ø¬ÙŠÙ… 2"];
        let pool = []; ks.forEach(k => { pool.push(...d[k]); d[k]=[]; });
        pool.sort(() => Math.random() - 0.5);
        pool.forEach(c => { d[(sys==='LS'?logicLS(d):logicSB(d))].push(c); });
        render(sys);
    }

    function manualAdd(sys, k) { let n = prompt("Ø±Ù‚Ù… Ø§Ù„ÙƒÙˆØ¯:"); if(n) { let full = config[sys].let + "-" + n.replace(/[^0-9]/g, ''); (sys === 'LS' ? dataLS : dataSB)[k].push(full); render(sys); } }
    function undo(sys) { if(config[sys].hist.length){ let l=config[sys].hist.pop(); (sys==='LS'?dataLS:dataSB)[l.t].pop(); render(sys); } }
    function switchSystem(sys) { currentSystem = sys; document.querySelectorAll('.system-container').forEach(c => c.classList.remove('active')); document.getElementById(`system${sys}`).classList.add('active'); document.getElementById('lsTabBtn').classList.toggle('active', sys==='LS'); document.getElementById('sbTabBtn').classList.toggle('active', sys==='SB'); }
    function toggleDigits(sys) { config[sys].dig = (config[sys].dig===3?4:3); document.getElementById(`digitBtn${sys}`).innerText = config[sys].dig + " Ø£Ø±Ù‚Ø§Ù…"; }
    function changeRepNum(sys) { let n = prompt("Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±:"); if(n) document.getElementById(`repNum${sys}`).innerText = n; }
    function resetSys(sys) { if(confirm("ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŸ")){ localStorage.removeItem(config[sys].storage); location.reload(); } }

    function copyAction() {
        const sys = currentSystem; 
        const d = (sys === 'LS' ? dataLS : dataSB);
        const r = document.getElementById(`repNum${sys}`).innerText;
        const now = new Date();
        const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø£Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
        const ksaTimeStr = now.toLocaleTimeString('en-US', { timeZone: 'Asia/Riyadh', hour: '2-digit', minute: '2-digit', hour12: true }).replace('AM', 'Øµ').replace('PM', 'Ù…');
        const ksaDateStr = now.toLocaleDateString('en-GB', { timeZone: 'Asia/Riyadh' }).split('/').reverse().join('/'); 
        let header = `ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª  ( ${sys === 'LS' ? 'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³' : 'Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ'} ) Ø±Ù‚Ù… ( ${r} )  ÙÙŠ ØªÙ…Ø§Ù… Ø§Ù„Ø³Ø§Ø¹Ù‡  (${ksaTimeStr} )  ÙÙŠ ÙŠÙˆÙ… ( ${days[now.getDay()]} ) Ø§Ù„ØªØ§Ø±ÙŠØ® ${ksaDateStr}\n\n`;
        const order = (sys === 'LS') ? ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"] : ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"];
        let body = "";
        order.forEach(k => {
            let label = (k === "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬") ? "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬" : k;
            let units = (d[k] && d[k].length > 0) ? (k.includes("Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª") ? d[k].join(" | ") + " |" : d[k].join("\n")) : (k.includes("Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª") ? "E-000 |" : "E-000");
            body += `${label} :\n${units}\n\n`;
        });
        navigator.clipboard.writeText(header + body).then(() => alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®"));
    }

    ['LS','SB'].forEach(sys => {
        ['E','A','F','M','S','C','G','P','H','R'].forEach(l => {
            let b = document.createElement('button'); b.className = 'let-btn' + (l === 'E' ? ` active-${sys.toLowerCase()}` : ''); b.innerText = l;
            b.onclick = () => { config[sys].let = l; document.querySelectorAll(`#letters${sys} .let-btn`).forEach(x => x.classList.remove(`active-ls`,`active-sb`)); b.classList.add(`active-${sys.toLowerCase()}`); };
            document.getElementById(`letters${sys}`).appendChild(b);
        });
        const saved = JSON.parse(localStorage.getItem(config[sys].storage)); if(saved) { if(sys === 'LS') dataLS = saved; else dataSB = saved; }
    });
    
    setInterval(() => { 
        let t = new Date().toLocaleTimeString('en-GB', { timeZone: 'Asia/Riyadh', hour: '2-digit', minute: '2-digit', hour12: false });
        document.getElementById('clockLS').innerText = t; document.getElementById('clockSB').innerText = t; 
    }, 1000);
    render('LS'); render('SB');
</script>
</body>
</html>
