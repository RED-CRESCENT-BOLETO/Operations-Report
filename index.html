<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ EMS Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <style>
        :root { --ls-color: #b32633; --sb-color: #0056b3; --accent: #ffd700; --dark: #0a0a0a; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #111; color: white; margin: 0; padding-bottom: 80px; }
        .tabs { display: flex; cursor: pointer; background: #222; border-bottom: 2px solid #333; }
        .tab { flex: 1; padding: 20px; text-align: center; font-size: 22px; font-weight: bold; transition: 0.3s; color: #777; }
        .tab.active-ls { background: var(--ls-color); color: white; }
        .tab.active-sb { background: var(--sb-color); color: white; }
        
        .panel { padding: 20px; display: none; }
        .panel.active { display: block; }

        .control-unit { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid #333; text-align: center; margin-bottom: 30px; }
        .letter-btn { width: 50px; height: 50px; margin: 3px; border: none; border-radius: 8px; background: #333; color: white; font-weight: bold; cursor: pointer; }
        .letter-btn.active { background: var(--accent); color: black; }
        
        .code-input { font-size: 50px; width: 180px; text-align: center; background: #000; color: white; border: 2px solid #444; border-radius: 12px; margin: 15px 0; outline: none; }
        .ls-border { border-color: var(--ls-color); color: var(--ls-color); }
        .sb-border { border-color: var(--sb-color); color: var(--sb-color); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .card { background: #151515; border-radius: 10px; border: 1px solid #333; overflow: hidden; }
        .card-header { padding: 12px; text-align: center; font-weight: bold; background: #222; font-size: 16px; border-bottom: 1px solid #333; }
        .ls-head { border-top: 5px solid var(--ls-color); }
        .sb-head { border-top: 5px solid var(--sb-color); }
        .card-body { padding: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; min-height: 60px; }
        
        .unit-tag { background: #000; border: 1px solid #444; padding: 6px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .unit-tag:hover { border-color: #f00; color: #f00; }

        .footer-tools { position: fixed; bottom: 0; width: 100%; background: #000; padding: 15px; border-top: 2px solid #333; display: flex; justify-content: center; gap: 15px; z-index: 100; }
        .btn-tool { padding: 12px 30px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div class="tabs">
    <div id="lsTab" class="tab active-ls" onclick="setMode('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³</div>
    <div id="sbTab" class="tab" onclick="setMode('SB')">Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ</div>
</div>

<div id="lsPanel" class="panel active">
    <div class="control-unit">
        <div id="lsLetters" class="letter-row"></div>
        <input type="text" id="lsInput" class="code-input ls-border" placeholder="000" maxlength="4">
        <div>
            <button class="btn-tool" style="background:#444; color:white;" onclick="undo('LS')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            <button class="btn-tool" style="background:#600; color:white;" onclick="reset('LS')">ØªØµÙÙŠØ± Ù„ÙˆØ³ âš ï¸</button>
        </div>
    </div>
    <div class="grid" id="lsGrid"></div>
</div>

<div id="sbPanel" class="panel">
    <div class="control-unit">
        <div id="sbLetters" class="letter-row"></div>
        <input type="text" id="sbInput" class="code-input sb-border" placeholder="000" maxlength="4">
        <div>
            <button class="btn-tool" style="background:#444; color:white;" onclick="undo('SB')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            <button class="btn-tool" style="background:#600; color:white;" onclick="reset('SB')">ØªØµÙÙŠØ± Ø³Ø§Ù†Ø¯ÙŠ âš ï¸</button>
        </div>
    </div>
    <div class="grid" id="sbGrid"></div>
</div>

<div class="footer-tools">
    <button class="btn-tool" style="background:#28a745; color:white;" onclick="copyReport()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
</div>

<script>
    let mode = 'LS';
    let letters = { LS: 'E', SB: 'E' };
    let history = { LS: [], SB: [] };

    // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ø·Ù„Ø¨Ùƒ
    const keysLS = ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 5", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];
    const keysSB = ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];

    let dataLS = {}; keysLS.forEach(k => dataLS[k] = []);
    let dataSB = {}; keysSB.forEach(k => dataSB[k] = []);

    // --- Ù…Ù†Ø·Ù‚ ØªÙˆØ²ÙŠØ¹ Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (Ø§Ù„Ø­Ø±ÙÙŠ) ---
    function getLsTarget() {
        if (dataLS["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (dataLS["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        let l2 = dataLS["Ù„Ø§Ù… 2"].length, l4 = dataLS["Ù„Ø§Ù… 4"].length, l3 = dataLS["Ù„Ø§Ù… 3"].length, l1 = dataLS["Ù„Ø§Ù… 1"].length, f = dataLS["ÙØ±Ø³Ø§Ù†"].length, l5 = dataLS["Ù„Ø§Ù… 5"].length;
        
        // Ø§ÙƒØªÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ (ÙˆØ­Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©)
        if (l2 < 1) return "Ù„Ø§Ù… 2"; if (l4 < 1) return "Ù„Ø§Ù… 4"; if (l3 < 1) return "Ù„Ø§Ù… 3"; if (l1 < 1) return "Ù„Ø§Ù… 1"; if (f < 1) return "ÙØ±Ø³Ø§Ù†";
        // ØªÙˆØ§Ø¬Ø¯ ÙˆØ­Ø¯Ø© Ø£Ø®Ø±Ù‰ (ÙˆØ­Ø¯ØªÙŠÙ†)
        if (l2 < 2) return "Ù„Ø§Ù… 2"; if (l4 < 2) return "Ù„Ø§Ù… 4"; if (l3 < 2) return "Ù„Ø§Ù… 3"; if (l1 < 2) return "Ù„Ø§Ù… 1";
        // ØªÙˆØ§Ø¬Ø¯ ÙˆØ­Ø¯Ø© Ø£Ø®Ø±Ù‰ (3 ÙˆØ­Ø¯Ø§Øª)
        if (l2 < 3) return "Ù„Ø§Ù… 2"; if (l4 < 3) return "Ù„Ø§Ù… 4"; if (l1 < 3) return "Ù„Ø§Ù… 1";
        // Ø§ÙƒØªÙØ§Ø¡ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø«Ù… Ù„Ø§Ù… 5
        if (l5 < 1) return "Ù„Ø§Ù… 5";

        return "Ù„Ø§Ù… 2"; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    }

    // --- Ù…Ù†Ø·Ù‚ ØªÙˆØ²ÙŠØ¹ Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (Ø§Ù„Ø­Ø±ÙÙŠ) ---
    function getSbTarget() {
        if (dataSB["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (dataSB["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        let s1 = dataSB["Ø³ÙŠÙ† 1"].length, b1 = dataSB["Ø¨Ø§Ø¡ 1"].length, s = dataSB["Ø³ÙŠÙ†"].length, g1 = dataSB["Ø¬ÙŠÙ… 1"].length, b = dataSB["Ø¨Ø§Ø¡"].length, g2 = dataSB["Ø¬ÙŠÙ… 2"].length;

        // Ø§ÙƒØªÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ (ÙˆØ­Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©)
        if (s1 < 1) return "Ø³ÙŠÙ† 1"; if (b1 < 1) return "Ø¨Ø§Ø¡ 1"; if (s < 1) return "Ø³ÙŠÙ†"; if (g1 < 1) return "Ø¬ÙŠÙ… 1"; if (b < 1) return "Ø¨Ø§Ø¡";
        // ØªÙˆØ§Ø¬Ø¯ ÙˆØ­Ø¯Ø© Ø£Ø®Ø±Ù‰ (ÙˆØ­Ø¯ØªÙŠÙ†)
        if (s1 < 2) return "Ø³ÙŠÙ† 1"; if (b1 < 2) return "Ø¨Ø§Ø¡ 1"; if (s < 2) return "Ø³ÙŠÙ†"; if (g1 < 2) return "Ø¬ÙŠÙ… 1"; if (b < 2) return "Ø¨Ø§Ø¡";
        // ØªÙˆØ§Ø¬Ø¯ ÙˆØ­Ø¯Ø© Ø£Ø®Ø±Ù‰ (3 ÙˆØ­Ø¯Ø§Øª)
        if (s1 < 3) return "Ø³ÙŠÙ† 1"; if (b1 < 3) return "Ø¨Ø§Ø¡ 1"; if (s < 3) return "Ø³ÙŠÙ†"; if (g1 < 3) return "Ø¬ÙŠÙ… 1";
        // ØªÙˆØ§Ø¬Ø¯ ÙˆØ­Ø¯Ø© Ø£Ø®Ø±Ù‰ (4 ÙˆØ­Ø¯Ø§Øª)
        if (s1 < 4) return "Ø³ÙŠÙ† 1"; if (s < 4) return "Ø³ÙŠÙ†"; if (b < 3) return "Ø¨Ø§Ø¡"; if (b < 4) return "Ø¨Ø§Ø¡";
        // Ø§ÙƒØªÙØ§Ø¡ Ø³ÙŠÙ† 1 ÙˆØ¨Ø§Ø¡ 1 ÙˆØ³ÙŠÙ† Ø«Ù… Ø¬ÙŠÙ… 2
        if (s1 >= 4 && b1 >= 3 && s >= 4) { if (g2 < 3) return "Ø¬ÙŠÙ… 2"; }

        return "Ø³ÙŠÙ† 1"; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    }

    function processInput(sys, val) {
        if (val.length >= 3) {
            let full = letters[sys] + "-" + val;
            let target = (sys === 'LS' ? getLsTarget() : getSbTarget());
            let d = (sys === 'LS' ? dataLS : dataSB);
            
            // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¥Ù„Ø§ ÙÙŠ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù
            let exists = false;
            for(let k in d) if(d[k].includes(full)) exists = true;
            if(exists && !["Ù‚ÙŠØ§Ø¯Ø©","Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…","Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"].includes(target)) {
                alert("Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø£Ø®Ø±Ù‰!");
            } else {
                d[target].push(full);
                history[sys].push(target);
            }
            document.getElementById(sys === 'LS' ? 'lsInput' : 'sbInput').value = '';
            render();
        }
    }

    document.getElementById('lsInput').oninput = (e) => processInput('LS', e.target.value.replace(/\D/g,''));
    document.getElementById('sbInput').oninput = (e) => processInput('SB', e.target.value.replace(/\D/g,''));

    function render() {
        // Ø±Ù†Ø¯Ø± Ù„ÙˆØ³
        const lsGrid = document.getElementById('lsGrid'); lsGrid.innerHTML = '';
        keysLS.forEach(k => {
            lsGrid.innerHTML += `<div class="card"><div class="card-header ls-head">${k}</div><div class="card-body">${dataLS[k].map((u,i)=>`<div class="unit-tag" onclick="removeUnit('LS','${k}',${i})">${u}</div>`).join('')}</div></div>`;
        });
        // Ø±Ù†Ø¯Ø± Ø³Ø§Ù†Ø¯ÙŠ
        const sbGrid = document.getElementById('sbGrid'); sbGrid.innerHTML = '';
        keysSB.forEach(k => {
            sbGrid.innerHTML += `<div class="card"><div class="card-header sb-head">${k}</div><div class="card-body">${dataSB[k].map((u,i)=>`<div class="unit-tag" onclick="removeUnit('SB','${k}',${i})">${u}</div>`).join('')}</div></div>`;
        });
    }

    function setMode(m) {
        mode = m;
        document.getElementById('lsPanel').classList.toggle('active', m==='LS');
        document.getElementById('sbPanel').classList.toggle('active', m==='SB');
        document.getElementById('lsTab').className = 'tab' + (m==='LS'?' active-ls':'');
        document.getElementById('sbTab').className = 'tab' + (m==='SB'?' active-sb':'');
    }

    function removeUnit(sys,k,i) { if(confirm("Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ")) { (sys==='LS'?dataLS:dataSB)[k].splice(i,1); render(); } }
    function undo(sys) { if(history[sys].length) { let t = history[sys].pop(); (sys==='LS'?dataLS:dataSB)[t].pop(); render(); } }
    function reset(sys) { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) { let d = (sys==='LS'?dataLS:dataSB); for(let k in d) d[k]=[]; history[sys]=[]; render(); } }

    function copyReport() {
        let sys = mode; let d = (sys==='LS'?dataLS:dataSB); let ks = (sys==='LS'?keysLS:keysSB);
        let txt = `ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª (${sys==='LS'?'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³':'Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ'})\n\n`;
        ks.forEach(k => {
            let units = d[k].length ? ( (k.includes("Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª")) ? d[k].join(' | ')+" |" : d[k].join('\n') ) : "E-000";
            txt += `${k} :\n${units}\n\n`;
        });
        navigator.clipboard.writeText(txt); alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±");
    }

    // Ø¨Ù†Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙˆÙ
    ['LS','SB'].forEach(sys => {
        let container = document.getElementById(sys.toLowerCase()+'Letters');
        ['E','A','F','M','S','C','G','P','H'].forEach(l => {
            let b = document.createElement('button'); b.className = 'letter-btn' + (l==='E'?' active':''); b.innerText = l;
            b.onclick = () => { letters[sys] = l; container.querySelectorAll('.letter-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
            container.appendChild(b);
        });
    });

    render();
</script>
</body>
</html>
