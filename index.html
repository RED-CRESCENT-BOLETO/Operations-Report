<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… ØªÙˆØ²ÙŠØ¹ EMS - Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø±ÙÙŠ</title>
    <style>
        :root { --ls-red: #b32633; --sb-blue: #0056b3; --gold: #ffd700; --bg: #0a0a0a; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #000; color: white; margin: 0; padding-bottom: 100px; }
        .tabs { display: flex; width: 100%; height: 60px; background: #111; border-bottom: 2px solid #333; }
        .tab-btn { flex: 1; border: none; cursor: pointer; font-size: 20px; font-weight: bold; color: #666; background: #111; transition: 0.3s; }
        .tab-btn.active-ls { background: var(--ls-red); color: white; }
        .tab-btn.active-sb { background: var(--sb-blue); color: white; }
        
        .container { padding: 20px; display: none; }
        .container.active { display: block; }

        .control-panel { background: #111; padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 20px; text-align: center; }
        .letter-btns { display: flex; justify-content: center; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        .l-btn { width: 45px; height: 45px; border: 1px solid #444; background: #222; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; }
        .l-btn.active { background: var(--gold); color: black; border-color: white; }
        
        .main-input { font-size: 55px; width: 200px; text-align: center; background: #000; border-radius: 12px; outline: none; margin: 10px 0; font-weight: bold; }
        .ls-input { border: 3px solid var(--ls-red); color: var(--ls-red); }
        .sb-input { border: 3px solid var(--sb-blue); color: var(--sb-blue); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .card { background: #161616; border-radius: 10px; border: 1px solid #333; min-height: 120px; }
        .card-h { padding: 10px; text-align: center; font-weight: bold; background: #222; font-size: 15px; border-bottom: 1px solid #333; }
        .ls-h { border-top: 4px solid var(--ls-red); }
        .sb-h { border-top: 4px solid var(--sb-blue); }
        .card-b { padding: 10px; display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
        
        .unit { background: #000; border: 1px solid #444; padding: 6px 12px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .unit:hover { color: #f00; border-color: #f00; }

        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: #000; padding: 15px; border-top: 2px solid #333; display: flex; justify-content: center; gap: 20px; }
        .btn-act { padding: 12px 40px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>

<div class="tabs">
    <button id="tabLS" class="tab-btn active-ls" onclick="setMode('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (LUSS)</button>
    <button id="tabSB" class="tab-btn" onclick="setMode('SB')">Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (SANDY)</button>
</div>

<div id="contLS" class="container active">
    <div class="control-panel">
        <div id="alphaLS" class="letter-btns"></div>
        <input type="text" id="inLS" class="main-input ls-input" placeholder="000" maxlength="4">
        <div style="margin-top:10px;">
            <button class="btn-act" style="background:#444; color:white;" onclick="undo('LS')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            <button class="btn-act" style="background:#600; color:white;" onclick="reset('LS')">ØªØµÙÙŠØ± âš ï¸</button>
        </div>
    </div>
    <div class="grid" id="gridLS"></div>
</div>

<div id="contSB" class="container">
    <div class="control-panel">
        <div id="alphaSB" class="letter-btns"></div>
        <input type="text" id="inSB" class="main-input sb-input" placeholder="000" maxlength="4">
        <div style="margin-top:10px;">
            <button class="btn-act" style="background:#444; color:white;" onclick="undo('SB')">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
            <button class="btn-act" style="background:#004; color:white;" onclick="reset('SB')">ØªØµÙÙŠØ± âš ï¸</button>
        </div>
    </div>
    <div class="grid" id="gridSB"></div>
</div>

<div class="bottom-bar">
    <button class="btn-act" style="background:#28a745; color:white;" onclick="copyReport()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<script>
    let currentMode = 'LS';
    let letters = { LS: 'E', SB: 'E' };
    let history = { LS: [], SB: [] };

    const keysLS = ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 5", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];
    const keysSB = ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"];

    let dataLS = {}; keysLS.forEach(k => dataLS[k] = []);
    let dataSB = {}; keysSB.forEach(k => dataSB[k] = []);

    // --- Ù…Ù†Ø·Ù‚ Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ Ø§Ù„Ø­Ø±ÙÙŠ ---
    function getLsTarget() {
        let d = dataLS;
        if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        let l1=d["Ù„Ø§Ù… 1"].length, l2=d["Ù„Ø§Ù… 2"].length, l3=d["Ù„Ø§Ù… 3"].length, l4=d["Ù„Ø§Ù… 4"].length, l5=d["Ù„Ø§Ù… 5"].length, f=d["ÙØ±Ø³Ø§Ù†"].length;

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: 5 ÙˆØ­Ø¯Ø§Øª ÙÙ‚Ø·
        if(l2<1) return "Ù„Ø§Ù… 2"; if(l4<1) return "Ù„Ø§Ù… 4"; if(l3<1) return "Ù„Ø§Ù… 3"; if(l1<1) return "Ù„Ø§Ù… 1"; if(f<1) return "ÙØ±Ø³Ø§Ù†";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø²ÙŠØ§Ø¯Ø© ÙˆØ­Ø¯ØªÙŠÙ†
        if(l2<2) return "Ù„Ø§Ù… 2"; if(l4<2) return "Ù„Ø§Ù… 4"; if(l3<2) return "Ù„Ø§Ù… 3"; if(l1<2) return "Ù„Ø§Ù… 1";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø²ÙŠØ§Ø¯Ø© Ø«Ù„Ø§Ø« ÙˆØ­Ø¯Ø§Øª
        if(l2<3) return "Ù„Ø§Ù… 2"; if(l4<3) return "Ù„Ø§Ù… 4"; if(l1<3) return "Ù„Ø§Ù… 1";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ù„Ø§Ù… 5
        if(l5<1) return "Ù„Ø§Ù… 5";
        // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø¬Ø¯ÙŠØ¯
        return "Ù„Ø§Ù… 2";
    }

    // --- Ù…Ù†Ø·Ù‚ Ø³Ø§Ù†Ø¯ÙŠ Ø§Ù„Ø­Ø±ÙÙŠ ---
    function getSbTarget() {
        let d = dataSB;
        if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";

        let s1=d["Ø³ÙŠÙ† 1"].length, b1=d["Ø¨Ø§Ø¡ 1"].length, s=d["Ø³ÙŠÙ†"].length, g1=d["Ø¬ÙŠÙ… 1"].length, b=d["Ø¨Ø§Ø¡"].length, g2=d["Ø¬ÙŠÙ… 2"].length;

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ÙˆØ­Ø¯Ø© Ù„ÙƒÙ„ Ù…Ù†Ø·Ù‚Ø©
        if(s1<1) return "Ø³ÙŠÙ† 1"; if(b1<1) return "Ø¨Ø§Ø¡ 1"; if(s<1) return "Ø³ÙŠÙ†"; if(g1<1) return "Ø¬ÙŠÙ… 1"; if(b<1) return "Ø¨Ø§Ø¡";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ÙˆØ­Ø¯ØªÙŠÙ†
        if(s1<2) return "Ø³ÙŠÙ† 1"; if(b1<2) return "Ø¨Ø§Ø¡ 1"; if(s<2) return "Ø³ÙŠÙ†"; if(g1<2) return "Ø¬ÙŠÙ… 1"; if(b<2) return "Ø¨Ø§Ø¡";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø«Ù„Ø§Ø« ÙˆØ­Ø¯Ø§Øª
        if(s1<3) return "Ø³ÙŠÙ† 1"; if(b1<3) return "Ø¨Ø§Ø¡ 1"; if(s<3) return "Ø³ÙŠÙ†"; if(g1<3) return "Ø¬ÙŠÙ… 1";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø£Ø±Ø¨Ø¹ ÙˆØ­Ø¯Ø§Øª
        if(s1<4) return "Ø³ÙŠÙ† 1"; if(s<4) return "Ø³ÙŠÙ†"; if(b<3) return "Ø¨Ø§Ø¡"; if(b<4) return "Ø¨Ø§Ø¡";
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø¬ÙŠÙ… 2 (Ø¨Ø¹Ø¯ Ø§ÙƒØªÙØ§Ø¡ Ø³ÙŠÙ† 1 ÙˆØ¨Ø§Ø¡ 1 ÙˆØ³ÙŠÙ†)
        if(s1>=4 && b1>=3 && s>=4) { if(g2<3) return "Ø¬ÙŠÙ… 2"; }

        return "Ø³ÙŠÙ† 1";
    }

    function handleInput(sys, val) {
        if (val.length >= 3) {
            let code = letters[sys] + "-" + val;
            let target = (sys === 'LS' ? getLsTarget() : getSbTarget());
            let currentData = (sys === 'LS' ? dataLS : dataSB);
            
            let exists = false;
            for(let k in currentData) if(currentData[k].includes(code)) exists = true;
            if(exists && !["Ù‚ÙŠØ§Ø¯Ø©","Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…","Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"].includes(target)) {
                alert("Ù…ÙƒØ±Ø±!");
            } else {
                currentData[target].push(code);
                history[sys].push(target);
            }
            document.getElementById(sys === 'LS' ? 'inLS' : 'inSB').value = '';
            render();
        }
    }

    document.getElementById('inLS').oninput = (e) => handleInput('LS', e.target.value.replace(/\D/g,''));
    document.getElementById('inSB').oninput = (e) => handleInput('SB', e.target.value.replace(/\D/g,''));

    function render() {
        // Ù„ÙˆØ³
        const gLS = document.getElementById('gridLS'); gLS.innerHTML = '';
        keysLS.forEach(k => {
            gLS.innerHTML += `<div class="card"><div class="card-h ls-h">${k}</div><div class="card-b">${dataLS[k].map((u,i)=>`<div class="unit" onclick="del('LS','${k}',${i})">${u}</div>`).join('')}</div></div>`;
        });
        // Ø³Ø§Ù†Ø¯ÙŠ
        const gSB = document.getElementById('gridSB'); gSB.innerHTML = '';
        keysSB.forEach(k => {
            gSB.innerHTML += `<div class="card"><div class="card-h sb-h">${k}</div><div class="card-b">${dataSB[k].map((u,i)=>`<div class="unit" onclick="del('SB','${k}',${i})">${u}</div>`).join('')}</div></div>`;
        });
    }

    function setMode(m) {
        currentMode = m;
        document.getElementById('contLS').classList.toggle('active', m==='LS');
        document.getElementById('contSB').classList.toggle('active', m==='SB');
        document.getElementById('tabLS').className = 'tab-btn' + (m==='LS'?' active-ls':'');
        document.getElementById('tabSB').className = 'tab-btn' + (m==='SB'?' active-sb':'');
    }

    function del(sys,k,i) { if(confirm("Ø­Ø°ÙØŸ")) { (sys==='LS'?dataLS:dataSB)[k].splice(i,1); render(); } }
    function undo(sys) { if(history[sys].length) { let t = history[sys].pop(); (sys==='LS'?dataLS:dataSB)[t].pop(); render(); } }
    function reset(sys) { if(confirm("ØªØµÙÙŠØ±ØŸ")) { let d = (sys==='LS'?dataLS:dataSB); for(let k in d) d[k]=[]; history[sys]=[]; render(); } }

    function copyReport() {
        let d = (currentMode==='LS'?dataLS:dataSB); let ks = (currentMode==='LS'?keysLS:keysSB);
        let txt = `ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª (${currentMode==='LS'?'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³':'Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ'})\n\n`;
        ks.forEach(k => {
            let units = d[k].length ? ( (k.includes("Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª")) ? d[k].join(' | ')+" |" : d[k].join('\n') ) : "E-000";
            txt += `${k} :\n${units}\n\n`;
        });
        navigator.clipboard.writeText(txt); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®");
    }

    ['LS','SB'].forEach(sys => {
        let container = document.getElementById('alpha' + sys);
        ['E','A','F','M','S','C','G','P','H'].forEach(l => {
            let b = document.createElement('button'); b.className = 'l-btn' + (l==='E'?' active':''); b.innerText = l;
            b.onclick = () => { letters[sys] = l; container.querySelectorAll('.l-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
            container.appendChild(b);
        });
    });
    render();
</script>
</body>
</html>
