<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… EMS - Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <style>
        :root { --red: #b32633; --blue: #0056b3; --gold: #ffd700; --bg: #0a0a0a; --purple: #6a1b9a; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: #111 url('https://i.top4top.io/p_3592jzcr01.jpg') no-repeat center center fixed; background-size: cover; color: white; margin: 0; padding: 10px; padding-bottom: 120px; }
        .overlay-bg { background: rgba(0,0,0,0.88); min-height: 100vh; padding: 20px; border-radius: 15px; }
        .mode-selection { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .btn-mode { flex: 1; max-width: 400px; padding: 18px; font-size: 22px; font-weight: 900; border-radius: 12px; border: 3px solid #333; cursor: pointer; color: white; background: #222; }
        #lsBtn.active { background: var(--red); border-color: white; box-shadow: 0 0 15px var(--red); }
        #ssBtn.active { background: var(--blue); border-color: white; box-shadow: 0 0 15px var(--blue); }
        .info-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg); padding: 12px; border-bottom: 3px solid var(--red); border-radius: 10px; margin-bottom: 20px; }
        .main-controls { background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; border: 1px solid #555; margin: 0 auto 30px auto; width: 96%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .letter-group { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; width: 100%; }
        .let-btn { width: 65px; height: 65px; border: 2px solid #444; background: #222; color: white; border-radius: 12px; cursor: pointer; font-size: 26px; font-weight: bold; }
        .let-btn.active { background: var(--red); border-color: white; box-shadow: 0 0 15px var(--red); }
        #mainInput { font-size: 55px; width: 220px; text-align: center; background: #000; color: var(--red); border: 2px solid #555; border-radius: 15px; padding: 10px; outline: none; }
        .btn-side { padding: 15px 25px; background: #333; color: white; border: 1px solid #555; border-radius: 10px; font-weight: bold; font-size: 20px; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .card { background: rgba(0,0,0,0.7); border: 1px solid #444; border-radius: 10px; min-height: 120px; display: flex; flex-direction: column; }
        .card-header { background: var(--red); padding: 10px; text-align: center; font-weight: bold; border-radius: 10px 10px 0 0; }
        .card-purple .card-header { background: var(--purple) !important; }
        .card-white .card-header { background: var(--white) !important; color: black; }
        .card-body { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .tag { background: #000; border: 1px solid var(--red); padding: 6px 14px; border-radius: 6px; font-weight: bold; position: relative; cursor: pointer; }
        .tag-menu { display: none; position: absolute; top: 100%; right: 0; background: #222; z-index: 100; border: 1px solid #555; width: 120px; }
        .tag:hover .tag-menu { display: block; }
        .tag-menu div { padding: 10px; cursor: pointer; border-bottom: 1px solid #333; }
        .bottom-actions { position: fixed; bottom: 0; left: 0; right: 0; background: #050505; padding: 20px; display: flex; justify-content: center; border-top: 3px solid var(--red); }
    </style>
</head>
<body>

<div class="overlay-bg">
    <div class="mode-selection">
        <button class="btn-mode active" id="lsBtn" onclick="setMode('LS')">Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³ (LS)</button>
        <button class="btn-mode" id="ssBtn" onclick="setMode('SB')">Ø³Ø§Ù†Ø¯ÙŠ ÙˆØ¨ÙˆÙ„ÙŠØªÙˆ (SB)</button>
    </div>

    <div class="info-bar">
        <div>ØªÙ‚Ø±ÙŠØ± Ø±Ù‚Ù…: <button onclick="changeRepNum()" id="repNum" style="background:none; color:var(--gold); border:1px solid #444; padding:5px 15px; cursor:pointer;">1</button></div>
        <div id="clock" style="font-size:20px; color:var(--gold)">00:00:00</div>
    </div>

    <div class="main-controls">
        <div style="display:flex; gap:10px;">
            <button class="btn-side" style="background:#444" onclick="rebalanceField()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</button>
            <button class="btn-side" style="background:#600" onclick="resetSystem()">âš ï¸ ØªØµÙÙŠØ±</button>
        </div>
        <div class="letter-group" id="letterGroup"></div>
        <div class="row-input">
            <button class="btn-side" id="digitBtn" onclick="toggleDigits()">3 Ø£Ø±Ù‚Ø§Ù…</button>
            <input type="text" id="mainInput" placeholder="000" inputmode="numeric" oninput="processInput(this)">
            <button class="btn-side" style="color:var(--gold)" onclick="undo()">ØªØ±Ø§Ø¬Ø¹ â†©ï¸</button>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
            <button class="btn-side" onclick="manual('Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">â• Ù‚ÙŠØ§Ø¯Ø©</button>
            <button class="btn-side" onclick="manual('Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…')">â• Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…</button>
            <button class="btn-side" onclick="manual('Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ')">â• Ù…Ø´Ø±Ù</button>
            <button class="btn-side" onclick="manual('ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°')">â• Ø¨Ø­Ø«</button>
            <button class="btn-side" onclick="manual('Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡')">â• Ù…ÙŠÙ†Ø§Ø¡</button>
            <button class="btn-side" onclick="manual('Ø¯Ø¹Ù…')">â• Ø¯Ø¹Ù…</button>
        </div>
    </div>

    <h3 id="secTitle" style="color:var(--gold); border-right:4px solid var(--red); padding-right:10px;">Ø§Ù„Ù…ÙŠØ¯Ø§Ù† ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
    <div class="grid" id="fieldGrid"></div>
    <h3 style="color:var(--gold); border-right:4px solid var(--red); padding-right:10px;">Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù</h3>
    <div class="grid" id="adminGrid"></div>
    <h3 style="color:var(--gold); border-right:4px solid var(--red); padding-right:10px;">Ø®Ø±ÙˆØ¬</h3>
    <div class="grid" id="exitGrid"></div>
</div>

<div class="bottom-actions">
    <button onclick="copyReport()" style="padding: 15px 100px; background:#218838; color:white; border-radius:10px; font-weight:bold; font-size:22px; cursor:pointer;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<script>
    let mode = 'LS', activeLet = 'E', digits = 3, lsCount = 0;
    let history = [];
    let data = {
        LS: { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù„Ø§Ù… 1":[], "Ù„Ø§Ù… 2":[], "Ù„Ø§Ù… 3":[], "Ù„Ø§Ù… 4":[], "Ù„Ø§Ù… 5":[], "ÙØ±Ø³Ø§Ù†":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] },
        SB: { "Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©":[], "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…":[], "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ":[], "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª":[], "Ø³ÙŠÙ† 1":[], "Ø¨Ø§Ø¡ 1":[], "Ø³ÙŠÙ†":[], "Ø¬ÙŠÙ… 1":[], "Ø¨Ø§Ø¡":[], "Ø¬ÙŠÙ… 2":[], "Ø¯Ø¹Ù…":[], "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡":[], "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°":[], "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":[] }
    };

    const visualNames = { "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…": "Ø§Ù„Ø§Ø´Ø±Ø§Ù Ø§Ù„Ø¹Ø§Ù…" };

    function isDuplicate(code) {
        for (let m in data) {
            for (let k in data[m]) {
                if (data[m][k].includes(code)) return true;
            }
        }
        return false;
    }

    function getNextTarget() {
        let d = data[mode];
        if (d["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        if (d["Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"].length === 0) return "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª";
        
        if (mode === 'LS') {
            lsCount++;
            const order = [null, "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5"];
            return (lsCount <= 13) ? order[lsCount] : ["Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"][(lsCount-14)%6];
        } else {
            let total = ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"].reduce((s, k) => s + d[k].length, 0);
            const path = ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2", "Ø¬ÙŠÙ… 2", "Ø¬ÙŠÙ… 2"];
            return total >= 21 ? ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"][(total - 21) % 6] : path[total];
        }
    }

    function distribute(code) {
        if (isDuplicate(code)) return;
        let target = getNextTarget();
        if(target) {
            data[mode][target].push(code);
            history.push({mode, target});
            render();
        }
    }

    function processInput(el) {
        el.value = el.value.replace(/[^0-9]/g, '');
        let currentLimit = (['M', 'F', 'A', 'S'].includes(activeLet)) ? 2 : digits;
        if (el.value.length >= currentLimit) {
            distribute(activeLet + "-" + el.value);
            el.value = '';
        }
    }

    function render() {
        document.getElementById('lsBtn').className = mode === 'LS' ? 'btn-mode active' : 'btn-mode';
        document.getElementById('ssBtn').className = mode === 'SB' ? 'btn-mode active' : 'btn-mode';
        const d = data[mode];
        const fieldKeys = mode === 'LS' ? ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"];
        const adminKeys = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø¯Ø¹Ù…"];
        
        const draw = (k) => {
            let cls = ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©","Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…","Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ"].includes(k) ? 'card-purple' : (["ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°","Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡","Ø¯Ø¹Ù…"].includes(k) ? 'card-white' : '');
            let tags = d[k].map((u, i) => `<div class="tag">${u}<div class="tag-menu"><div onclick="toExit('${k}',${i})">â¡ï¸ Ø®Ø±ÙˆØ¬</div><div onclick="del('${k}',${i})">âŒ Ø­Ø°Ù</div></div></div>`).join('');
            // Ù‡Ù†Ø§ Ù†ØºÙŠØ± Ø§Ù„Ù…Ø³Ù…Ù‰ Ø¨ØµØ±ÙŠØ§Ù‹ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¨ÙˆÙƒØ³
            let displayName = visualNames[k] || k;
            return `<div class="card ${cls}"><div class="card-header">${displayName}</div><div class="card-body">${tags}</div></div>`;
        };
        document.getElementById('fieldGrid').innerHTML = fieldKeys.map(draw).join('');
        document.getElementById('adminGrid').innerHTML = adminKeys.map(draw).join('');
        document.getElementById('exitGrid').innerHTML = draw("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
        localStorage.setItem('ems_v5_final', JSON.stringify({data, lsCount}));
    }

    function toExit(k, i) { 
        data[mode]["ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"].push(data[mode][k].splice(i, 1)[0]); 
        const fieldUnits = mode === 'LS' ? ["Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"];
        if (fieldUnits.includes(k)) rebalanceField(); 
        else render();
    }

    function del(k, i) { data[mode][k].splice(i, 1); render(); }

    function rebalanceField() {
        let fieldUnits = mode === 'LS' ? ["Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"] : ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"];
        let allFieldCodes = [];
        fieldUnits.forEach(k => { allFieldCodes.push(...data[mode][k]); data[mode][k] = []; });
        if(mode === 'LS') lsCount = 0;
        allFieldCodes.forEach(u => {
            let target;
            if (mode === 'LS') {
                lsCount++;
                const order = [null, "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "ÙØ±Ø³Ø§Ù†", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5"];
                target = (lsCount <= 13) ? order[lsCount] : ["Ù„Ø§Ù… 2", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†"][(lsCount-14)%6];
            } else {
                let currentTotal = ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"].reduce((s, k) => s + data.SB[k].length, 0);
                const path = ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2", "Ø¬ÙŠÙ… 2", "Ø¬ÙŠÙ… 2"];
                target = currentTotal >= 21 ? ["Ø³ÙŠÙ† 1", "Ø¨Ø§Ø¡ 1", "Ø³ÙŠÙ†", "Ø¬ÙŠÙ… 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 2"][(currentTotal - 21) % 6] : path[currentTotal];
            }
            data[mode][target].push(u);
        });
        render();
    }

    function copyReport() {
        const now = new Date();
        const rNum = document.getElementById('repNum').innerText;
        const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }).replace('AM', 'Øµ').replace('PM', 'Ù…');
        const dateStr = now.toLocaleDateString('en-GB').split('/').reverse().join('/');
        const dayStr = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"][now.getDay()];

        let header = `ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª ( ${mode === 'LS' ? 'Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³' : 'Ø³Ø§Ù†Ø¯ÙŠ Ùˆ Ø¨ÙˆÙ„ÙŠØªÙˆ'} ) Ø±Ù‚Ù… ( ${rNum} ) ÙÙŠ ØªÙ…Ø§Ù… Ø§Ù„Ø³Ø§Ø¹Ù‡ (${timeStr}) ÙÙŠ ÙŠÙˆÙ… ( ${dayStr} ) Ø§Ù„ØªØ§Ø±ÙŠØ® ${dateStr}\n\n`;
        let finalTxt = header;

        const order = mode === 'LS' ? 
            ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù„Ø§Ù… 1", "Ù„Ø§Ù… 2", "Ù„Ø§Ù… 3", "Ù„Ø§Ù… 4", "Ù„Ø§Ù… 5", "ÙØ±Ø³Ø§Ù†", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"] :
            ["Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©", "Ø§Ø´Ø±Ø§Ù Ø¹Ø§Ù…", "Ù…Ø´Ø±Ù Ù…ÙŠØ¯Ø§Ù†ÙŠ", "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", "Ø³ÙŠÙ† 1", "Ø³ÙŠÙ†", "Ø¨Ø§Ø¡ 1", "Ø¨Ø§Ø¡", "Ø¬ÙŠÙ… 1", "Ø¬ÙŠÙ… 2", "Ø¯Ø¹Ù…", "Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„Ø§Ù†Ù‚Ø§Ø°", "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"];

        order.forEach(k => {
            let content = data[mode][k].length ? data[mode][k].join('\n') : activeLet + '-000';
            if(k === "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" || k === "Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª") {
                content = data[mode][k].length ? data[mode][k].join(' | ') + " |" : activeLet + '-000 |';
            }
            finalTxt += `${k} :\n${content}\n\n`;
        });
        navigator.clipboard.writeText(finalTxt);
        alert(`âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ØµÙ„ÙŠ`);
    }

    function manual(k) { 
        let n = prompt("Ø§Ù„ÙƒÙˆØ¯:"); 
        if(n){ 
            let fullCode = activeLet + "-" + n;
            if(isDuplicate(fullCode)) return;
            data[mode][k].push(fullCode); 
            render(); 
        }
    }
    function toggleDigits() { digits = (digits === 3) ? 4 : 3; document.getElementById('digitBtn').innerText = digits + " Ø£Ø±Ù‚Ø§Ù…"; }
    function resetSystem() { if(confirm("ØªØµÙÙŠØ±ØŸ")) { localStorage.removeItem('ems_v5_final'); location.reload(); }}
    function setMode(m) { mode = m; render(); }
    function changeRepNum() { let n = prompt("Ø§Ù„Ø±Ù‚Ù…:"); if(n) document.getElementById('repNum').innerText = n; }
    function undo() { if(history.length){ let l = history.pop(); data[l.mode][l.target].pop(); render(); } }

    const lets = ['E','A','F','M','S','C','G','P','H'];
    lets.forEach(l => {
        let b = document.createElement('button'); b.className = 'let-btn' + (l === activeLet ? ' active' : ''); b.innerText = l;
        b.onclick = () => { 
            activeLet = l; 
            document.querySelectorAll('.let-btn').forEach(x => x.classList.remove('active')); 
            b.classList.add('active'); 
            document.getElementById('mainInput').placeholder = (['M', 'F', 'A', 'S'].includes(l)) ? "00" : "000";
        };
        document.getElementById('letterGroup').appendChild(b);
    });

    const saved = JSON.parse(localStorage.getItem('ems_v5_final'));
    if(saved) { data = saved.data; lsCount = saved.lsCount; }
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-US', {hour12: false}); }, 1000);
    render();
</script>
</body>
</html>
